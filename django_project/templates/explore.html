<html>
  <body>
    <div>
      <table>
        <thead>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Address</th>
        </thead>
        <tbody id='history'>
        </tbody>
      </table>
    </div>
    <script>
      function executeEverything() {
        fetch('/api/coordinates/').then(
          function (response) { return response.json() }
        ).then(
          function (data) { 
            var tbody = document.getElementById("history");
            var geocoder  = new google.maps.Geocoder();             // create a geocoder object

            data.forEach(
              function (dataRow) {
                var row = document.createElement('tr');
                var latitude = document.createTextNode(dataRow.latitude);
                var longitude = document.createTextNode(dataRow.longitude);

                tbody.append(row);
                var td = document.createElement('td');
                row.append(td);
                td.append(latitude);
                td = document.createElement('td');
                row.append(td);
                td.append(longitude);

                var location  = new google.maps.LatLng(dataRow.latitude, dataRow.longitude);
                geocoder.geocode(
                  {'latLng': location},
                  function (results, status) {
                    if(status == google.maps.GeocoderStatus.OK) {           // if geocode success
                      var address = document.createTextNode(results[0].formatted_address);
                      td = document.createElement('td');
                      row.append(td);
                      td.append(address);
                    }
                  }
                )
              }
            )
          }
        )
      }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARmmE4s32sgyWffg1Oo3oWKcsw2TUTmd0&callback=executeEverything"></script>
  </body>
</html>
